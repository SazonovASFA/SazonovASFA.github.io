<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tone"></script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


<!-- Create a div where the graph will take place -->

<div class="w3-container w3-border w3-large">
<p><span style="font-weight: bold">Every Interval at Once</span>
<!---<button class="w3-bar-item w3-button" onclick="openPage('Home', this)"> Info </button>
<button class="w3-bar-item w3-button" onclick="openPage('Songs', this)">  Songs </button>-->
<button class="w3-bar-item w3-button" onclick="openPage('News', this)" id="defaultOpen"> Map </button>
<button class="w3-bar-item w3-button" onclick="openPage('Data', this)"> Data </button>
<button class="w3-bar-item w3-button" onclick="openPage('Acknowledgements', this)"> Acknowledgements </button></p>



</div>
<style>body {


background-color: white;
}</style>

<div id="Home" class="tabcontent">
  <h3 style="margin-left: 25px;">Every Interval at Once</h3>
  <p style="margin-left: 25px;">Every Interval at Once is a project centered around applying music theoretical principles for the sake of music information retrieval, specifically harmony and melody. </p>
  
  <figure>
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/60/Torus_from_rectangle.gif" alt="Torus_from_rectangle" width="30%">
  <figcaption>Fig.1 <a href = https://en.m.wikipedia.org/wiki/File:Torus_from_rectangle.gif>Torus from a rectangle</a></figcaption>
  <p style="margin-left: 25px;"></p>
  </figure>

  

  <img src="Pentatonality (1).png" alt="Pentatonality Matrix" width="30%">
  <img src="Chromaticism.png" alt="Chromaticism Matrix" width="30%">
  <img src="Consonance (2).png" alt="Consonance Matrix" width="30%">
  <img src="Diatonality (2).png" alt="Diatonality Matrix" width="30%">
  <img src="Polarity (1).png" alt="Polarity Matrix" width="30%">
  <img src="Tenney Height.png" alt="Tenney Height Matrix" width="30%">
  
  As of now, I'm working on adding more features to this website, such as the ability to filter by year, genre, and 
  a rederivation of a Markov matrix from the interval distribution, to be able to 'hear' the map through a Markovian recreation.

  <p>The entire dataset of 23056 songs is available <a href="https://figshare.com/articles/dataset/EveryIntervalMIDIDATA/25322941">here.</a></p>

  <!--<button class="w3-bar-item w3-button" onclick="playLoop()"> Loop </button>
  <script>/*
  const synth = new Tone.Synth().toDestination();
  const seq = new Tone.Sequence((time, note) => {
    synth.triggerAttackRelease(note, 0.1, time);
    // subdivisions are given as subarrays
  }, ["E4", "Eb4" ,"D4", "Eb4", "E4"]).start(0);
  Tone.Transport.bpm.value = 120;
  var loop_on = 0;
  function playLoop() {
    if(loop_on==0) {
      loop_on=1
      Tone.start();
      Tone.Transport.start();
      
    } else {
      Tone.Transport.stop();
      loop_on=0;
    }
    
  }*/
  </script>-->
</div>

<div id="Songs" class="tabcontent">
  <p style="margin-left: 25px;">Work in progress! This section will contain a search bar for songs, and return a few similar songs.</p>
  <!--<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for names..">

  <ul id="myUL">
    <li><a href="#">Adele</a></li>
    <li><a href="#">Agnes</a></li>
  
    <li><a href="#">Billy</a></li>
    <li><a href="#">Bob</a></li>
  
    <li><a href="#">Calvin</a></li>
    <li><a href="#">Christina</a></li>
    <li><a href="#">Cindy</a></li>
  </ul>
  <style>#myInput {
    background-image: url('/css/searchicon.png'); /* Add a search icon to input */
    background-position: 10px 12px; /* Position the search icon */
    background-repeat: no-repeat; /* Do not repeat the icon image */
    width: 100%; /* Full-width */
    font-size: 16px; /* Increase font-size */
    padding: 12px 20px 12px 40px; /* Add some padding */
    border: 1px solid #ddd; /* Add a grey border */
    margin-bottom: 12px; /* Add some space below the input */
  }
  
  #myUL {
    /* Remove default list styling */
    list-style-type: none;
    padding: 0;
    margin: 0;
  }
  
  #myUL li a {
    border: 1px solid #ddd; /* Add a border to all links */
    margin-top: -1px; /* Prevent double borders */
    background-color: #f6f6f6; /* Grey background color */
    padding: 12px; /* Add some padding */
    text-decoration: none; /* Remove default text underline */
    font-size: 18px; /* Increase the font-size */
    color: black; /* Add a black text color */
    display: block; /* Make it into a block element to fill the whole list */
  }
  
  #myUL li a:hover:not(.header) {
    background-color: #eee; /* Add a hover effect to all links, except for headers */
  }</style>
  <script>function myFunction() {
    // Declare variables
    var input, filter, ul, li, a, i, txtValue;
    input = document.getElementById('myInput');
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL");
    li = ul.getElementsByTagName('li');
  
    // Loop through all list items, and hide those who don't match the search query
    for (i = 0; i < li.length; i++) {
      a = li[i].getElementsByTagName("a")[0];
      txtValue = a.textContent || a.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        li[i].style.display = "";
      } else {
        li[i].style.display = "none";
      }
    }
  }</script>-->

</div>

<div id="Acknowledgements" class="tabcontent">
  <h3 style="margin-left: 25px;">Acknowledgements</h3>
  <p style="margin-left: 25px;">Thank you to Dr. Edward Sazonov for providing me with the computational resources at the University of Alabama to complete this research project,<br>
    Dr. Cecil Flournoy, for advising me throughout the research process, and<br>
    Ms. Hugsin Chin, for directing the Alabama School of Fine Arts Math & Science Department.<br>
    Also, visit <a href="http://everynoise.com/">Every Noise at Once</a>, which inspired this project!</p>
  
</div>

<div id="News" class="tabcontent">
  <!--<input type="range" name="mySlider" id=mySlider min="1950" max="2023" value="2023">-->
  
  <div id="my_dataviz"></div>
</div>
<div id="Data" class="tabcontent">
  
</div>



<script>
  // Function to switch between tabs
  var newsGraphRendered = false;
  //var matGraphRendered = false;

 

  function rgbToHex(r, g, b) {
  return "#" + (1 << 24 | r << 16 | g << 8 | b).toString(16).slice(1);
  }
  function openPage(pageName, elmnt, color) {
    var i, tabcontent, tablinks;

    // Hide all tab content
    tabcontent = document.getElementsByClassName('tabcontent');
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = 'none'
    }

    // Deactivate all tab links
    tablinks = document.getElementsByClassName('tablink');
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].style.backgroundColor = '';
    }
    // Show the selected tab content and mark the tab link as active
    document.getElementById(pageName).style.display = 'block';
    elmnt.style.backgroundColor = color;
    
    // If the News tab is opened, render the D3.js graph
    if (pageName === 'News' && !newsGraphRendered) {
      renderGraph(2023);
      newsGraphRendered = true;
    } 
    if (pageName === 'Data') {
      window.location.href = "https://figshare.com/articles/dataset/EveryIntervalMIDIDATA/25322941";
    } 

  }
  

  // D3.js code for rendering the graph
  function renderGraph(selectedYear) {
    var margin = {top: 0, right: 0, bottom: 0, left: 0},
        width = 900*2 - margin.left - margin.right,
        height = 600*2 - margin.top - margin.bottom;

    var svg = d3.select("#News")
            
          .append("g")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .call(d3.zoom().on("zoom", function () {
              svg.attr("transform", d3.event.transform)
            }))
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Add a rect for background
    //svg.append("rect")
      //.attr("x", 0)
      //.attr("y", 0)
      //.attr("height", height)
      //.attr("width", width)
      //.style("fill", "EBEBEB");

    svg.append("rect")
      .attr("width", "100%")
      .attr("height", "100%")
      .attr("fill", "white");

    // Read the data
    d3.csv("https://raw.githubusercontent.com/buildercatninja/EveryIntervalcsv/main/EIAOUmapfile.csv", function(data) {
      
      // Add X axis
      var x = d3.scaleLinear()
        .domain([-2.5, 12.5])
        .range([0, width]);
      svg.append("g")
      //  .attr("transform", "translate(0," + height + ")")
      //  .call(d3.axisBottom(x));

      // Add Y axis
      var y = d3.scaleLinear()
        .domain([0, 10])
        .range([height, 0]);
      svg.append("g")
      //  .call(d3.axisLeft(y));

      // Add a tooltip div.
      var tooltip = d3.select("#my_dataviz")
        .append("div")
        .style("bottom",5)
        .style("left",5)
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "1px")
        .style("border-radius", "5px")
        .style("padding", "10px")
        .style("position","fixed")
        .style("bottom","10px")
        

      // A function that changes the tooltip when the user hovers over a point.
      var mouseover = function(d) {
        tooltip.style("opacity", 1);
        
        //const synth = new Tone.Synth().toDestination();
        //synth.triggerAttackRelease("C4", "8n");
      };

      var mousemove = function(d) {
        tooltip
          
          .html(d.Title + " - " + d.Artist + ", " + d.Genre + " (" + d.x + "," + d.y + ")")     
      };

      var touchstart = function(d) {
        tooltip
          
          .html(d.Title + " - " + d.Artist + ", " + d.Genre + " (" + d.x + "," + d.y + ")")     
      };
      
      

      var mouseleave = function(d) {
        //tooltip.transition().duration(2000).style("opacity", 0);
      };


      

      
      scatterplot = svg
        .append('g')
        .selectAll("dot")
        .data(data)
        .enter()
        .append("circle")
          .attr("cx", function(d) { 
            if(d.Year<=selectedYear) {
              return x(d.x);
            } else {return x(0)}
            })
          .attr("cy", function(d) { 
            if(d.Year<=selectedYear) {
              return y(d.y);
            } else { return y(0)} })
          .attr("r", 1.6)
          .style("fill", function(d) { 
            if(d.Year<=selectedYear) {
              return rgbToHex(d.r*255,d.g*255,d.b*255); 
            } else {return rgbToHex(255,255,255)}
          })
          .style("opacity", 1)
        .on("mouseover", mouseover)
        .on("mousemove", function(event, d) { mousemove(event, d); })
        .on("mouseleave", mouseleave);

      
    });
    

  }
  document.getElementById("defaultOpen").click();
</script>






</html>
